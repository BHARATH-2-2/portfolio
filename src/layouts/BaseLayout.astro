---
import PageTransition from '../components/motion/PageTransition.tsx';
import ScrollProgress from '../components/motion/ScrollProgress.tsx';
import SmoothScroll from '../components/motion/SmoothScroll.tsx';
import BackgroundVisuals from '../components/visuals/BackgroundVisuals.tsx';

export interface Props {
    title?: string;
    description?: string;
    image?: string;
    type?: 'website' | 'article';
    publishedTime?: string;
}

const { 
    title = 'Bharath N â€” Portfolio & Blog', 
    description = 'Projects, achievements, and technical blog by Bharath N.',
    image = '/og-image.png',
    type = 'website',
    publishedTime
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site || 'https://example.com');
const ogImage = new URL(image, canonicalURL);
---
<!doctype html>
<html lang="en" class="scroll-smooth">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="description" content={description} />
        <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
        <link rel="canonical" href={canonicalURL} />
        
        {/* Open Graph */}
        <meta property="og:title" content={title} />
        <meta property="og:description" content={description} />
        <meta property="og:image" content={ogImage} />
        <meta property="og:type" content={type} />
        <meta property="og:url" content={canonicalURL} />
        {type === 'article' && publishedTime && (
            <meta property="article:published_time" content={publishedTime} />
        )}
        
        {/* Twitter Card */}
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:title" content={title} />
        <meta name="twitter:description" content={description} />
        <meta name="twitter:image" content={ogImage} />
        
        {/* Theme color */}
        <meta name="theme-color" content="#10b981" media="(prefers-color-scheme: light)" />
        <meta name="theme-color" content="#18181b" media="(prefers-color-scheme: dark)" />
        
        <title>{title}</title>
    </head>
    <body class="bg-white text-zinc-900 dark:bg-zinc-950 dark:text-zinc-100 antialiased selection:bg-emerald-300/40 selection:text-emerald-900">
        <ScrollProgress client:load />
        <BackgroundVisuals client:load />
        <SmoothScroll client:load />
        <slot name="app-header" />
        <main class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
            <PageTransition client:load className="contents">
                <slot />
            </PageTransition>
        </main>
        <slot name="app-footer" />
        <script is:inline>
            (function() {
                const storedTheme = localStorage.getItem('theme');
                const htmlEl = document.documentElement;
                
                if (storedTheme === 'dark') {
                    htmlEl.classList.add('dark');
                } else if (storedTheme === 'light') {
                    htmlEl.classList.remove('dark');
                } else {
                    // No stored preference - use system preference
                    const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    if (systemPrefersDark) {
                        htmlEl.classList.add('dark');
                    } else {
                        htmlEl.classList.remove('dark');
                    }
                }
            })();
        </script>
    </body>
</html>

---
<style is:global>
    @import "../styles/global.css";
</style>

